controller:
  service:
    type: LoadBalancer
  extraArgs:
    # TCP proxy for mail ports: nginx watches this ConfigMap and dynamically proxies
    # TCP connections to per-tenant Stalwart ClusterIP services.
    # The ConfigMap is managed by deploy-stalwart.sh (adds ports per tenant).
    # Port 25 is NOT included (uses dedicated Postfix to preserve client IPs).
    tcp-services-configmap: "infra-ingress/tcp-services"
  resources:
    requests:
      cpu: 20m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi
  config:
    # Basic nginx configuration
    # Global security headers applied to all ingresses
    add-headers: "infra-ingress/nginx-custom-headers"
    server-tokens: "false"
    hide-headers: "X-Powered-By,Server"
    # Cloudflare proxy: extract real client IP from CF-Connecting-IP header
    use-forwarded-headers: "true"
    compute-full-forwarded-for: "true"
    enable-real-ip: "true"
    real-ip-header: "CF-Connecting-IP"
    # Trust Cloudflare proxy IPs and internal pod/service networks
    set-real-ip-from: "173.245.48.0/20,103.21.244.0/22,103.22.200.0/22,103.31.4.0/22,141.101.64.0/18,108.162.192.0/18,190.93.240.0/20,188.114.96.0/20,197.234.240.0/22,198.41.128.0/17,162.158.0.0/15,104.16.0.0/13,104.24.0.0/14,172.64.0.0/13,131.0.72.0/22,2400:cb00::/32,2606:4700::/32,2803:f800::/32,2405:b500::/32,2405:8100::/32,2a06:98c0::/29,2c0f:f248::/32,192.168.0.0/16,10.0.0.0/8"

# Disable admission webhook temporarily to avoid connection issues
admissionWebhooks:
  enabled: false
