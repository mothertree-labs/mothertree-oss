# Keycloak Configuration for LaSuite Docs
# Uses existing PostgreSQL database

# Authentication
# Passwords are set via environment-specific overrides (apps/environments/<env>/keycloak.yaml.gotmpl)
# sourced from tenant secrets via KEYCLOAK_ADMIN_PASSWORD and KEYCLOAK_DB_PASSWORD env vars
auth:
  adminUser: admin
  # adminPassword: overridden by env-specific gotmpl via KEYCLOAK_ADMIN_PASSWORD

# Use existing PostgreSQL instead of embedded
postgresql:
  enabled: false

# External database configuration
externalDatabase:
  host: docs-postgresql
  port: 5432
  user: keycloak
  # password: overridden by env-specific gotmpl via KEYCLOAK_DB_PASSWORD
  database: keycloak

# Resource allocation (reduced for single-node dev environment)
resources:
  requests:
    cpu: 150m
    memory: 512Mi
  limits:
    cpu: 500m
    memory: 1Gi

# Ingress configuration
ingress:
  enabled: true
  ingressClassName: nginx
  # hostname is set in environment-specific files
  tls: true
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/proxy-buffer-size: "16k"
    nginx.ingress.kubernetes.io/proxy-buffers-number: "8"

# Production settings
production: true
proxy: edge

# TLS configuration for production mode
tls:
  enabled: true
  autoGenerated:
    enabled: true

# Disable metrics to save resources
metrics:
  enabled: false

# Security context
securityContext:
  enabled: true
  fsGroup: 1001

# Service configuration
service:
  type: ClusterIP
  ports:
    http: 8080
    https: 8443

# Disable read replicas to save resources
readReplicas:
  replicaCount: 0

# Override image to use a working tag
image:
  tag: 23.0.7-debian-12-r3
