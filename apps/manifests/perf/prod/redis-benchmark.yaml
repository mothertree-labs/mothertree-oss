apiVersion: batch/v1
kind: Job
metadata:
  name: redis-benchmark
  namespace: perf
  labels:
    env: prod
    app: redis
spec:
  ttlSecondsAfterFinished: 600
  template:
    metadata:
      labels:
        env: prod
        app: redis
    spec:
      restartPolicy: Never
      containers:
        - name: redis-benchmark
          image: redis:7
          env:
            - name: REDIS_ADDR
              value: "${REDIS_ADDR}"
          command: ["sh", "-lc"]
          args:
            - |
              hostport=${REDIS_ADDR:-redis:6379}; host=${hostport%:*}; port=${hostport##*:}; \
              echo "Benchmarking $host:$port" && \
              redis-benchmark -h "$host" -p "$port" -n 200000 -c 100 -t set,get,incr,lpush,rpush


